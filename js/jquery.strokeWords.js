!function(c){for(var g=0,e=["webkit","moz"],h=c.requestAnimationFrame,k=c.cancelRequestAnimationFrame,l=e.length;0<=--l;)h=c[e[l]+"RequestAnimationFrame"],k=c[e[l]+"CancelRequestAnimationFrame"];if(!h||!k)h=function(c){var a=+Date.now(),d=Math.max(g+16,a);return setTimeout(function(){c(g=d)},d-a)},k=clearTimeout;c.requestAnimationFrame=h;c.cancelRequestAnimationFrame=k}(window);(function(){$(function(){var c,g,e,h,k,l,i;h=function(a,d){return $.get("utf8/"+a.toLowerCase()+".xml",d,"xml")};c=function(a){this.val=a;this.utf8code=escape(a).replace(/%u/,"");this.strokes=[];return this.init()};c.prototype.init=function(){return this.time=this.currentTrack=this.currentStroke=0};c.prototype.drawBackground=function(a){a.fillStyle="#FFF";a.fillRect(0,0,860,860);return e(a)};c.prototype.draw=function(a){var d=this;this.init();a.strokeStyle="#000";a.fillStyle="#000";a.lineWidth=5;
requestAnimationFrame(function(){return d.update(a)});return this.promise=$.Deferred()};c.prototype.update=function(a){var d,b,j=this;if(!(this.currentStroke>=this.strokes.length)){b=this.strokes[this.currentStroke];0===this.time&&(this.vector={x:b.track[this.currentTrack+1].x-b.track[this.currentTrack].x,y:b.track[this.currentTrack+1].y-b.track[this.currentTrack].y,size:b.track[this.currentTrack].size},a.save(),a.beginPath(),i(a,b.outline),a.clip());for(d=1;10>=d&&!(this.time+=0.02,1<=this.time&&
(this.time=1),a.beginPath(),a.arc(0.4*(b.track[this.currentTrack].x+this.vector.x*this.time),0.4*(b.track[this.currentTrack].y+this.vector.y*this.time),0.8*this.vector.size,0,2*Math.PI),1<=this.time);++d);a.fill();d=0;1<=this.time&&(a.restore(),this.time=0,this.currentTrack+=1);this.currentTrack>=b.track.length-1&&(this.currentTrack=0,this.currentStroke+=1,d=0.25);return this.currentStroke>=this.strokes.length?setTimeout(function(){return j.promise.resolve()},500):d?setTimeout(function(){return requestAnimationFrame(function(){return j.update(a)})},
1E3*d):requestAnimationFrame(function(){return j.update(a)})}};e=function(a){a.strokeStyle="#A33";a.beginPath();a.lineWidth=10;a.moveTo(0,0);a.lineTo(0,860);a.lineTo(860,860);a.lineTo(860,0);a.lineTo(0,0);a.stroke();a.beginPath();a.lineWidth=2;a.moveTo(0,860/3);a.lineTo(860,860/3);a.moveTo(0,2*(860/3));a.lineTo(860,2*(860/3));a.moveTo(860/3,0);a.lineTo(860/3,860);a.moveTo(2*(860/3),0);a.lineTo(2*(860/3),860);return a.stroke()};i=function(a,d){var b,j,c,f;f=[];j=0;for(c=d.length;j<c;j++)switch(b=d[j],
b.type){case "M":f.push(a.moveTo(0.4*b.x,0.4*b.y));break;case "L":f.push(a.lineTo(0.4*b.x,0.4*b.y));break;case "C":f.push(a.bezierCurveTo(0.4*b.begin.x,0.4*b.begin.y,0.4*b.mid.x,0.4*b.mid.y,0.4*b.end.x,0.4*b.end.y));break;case "Q":f.push(a.quadraticCurveTo(0.4*b.begin.x,0.4*b.begin.y,0.4*b.end.x,0.4*b.end.y));break;default:f.push(void 0)}return f};k=function(a){var d,b,c,e,f;b=[];f=a.childNodes;c=0;for(e=f.length;c<e;c++)if(d=f[c],1===d.nodeType&&(a=d.attributes))switch(d.nodeName){case "MoveTo":b.push({type:"M",
x:parseFloat(a.x.value),y:parseFloat(a.y.value)});break;case "LineTo":b.push({type:"L",x:parseFloat(a.x.value),y:parseFloat(a.y.value)});break;case "CubicTo":b.push({type:"C",begin:{x:parseFloat(a.x1.value),y:parseFloat(a.y1.value)},mid:{x:parseFloat(a.x2.value),y:parseFloat(a.y2.value)},end:{x:parseFloat(a.x3.value),y:parseFloat(a.y3.value)}});break;case "QuadTo":b.push({type:"Q",begin:{x:parseFloat(a.x1.value),y:parseFloat(a.y1.value)},end:{x:parseFloat(a.x2.value),y:parseFloat(a.y2.value)}})}return b};
l=function(a){var d,b,c,e,f;b=[];f=a.childNodes;c=0;for(e=f.length;c<e;c++)if(d=f[c],1===d.nodeType&&(a=d.attributes))switch(d.nodeName){case "MoveTo":b.push({x:parseFloat(a.x.value),y:parseFloat(a.y.value),size:a.size?parseFloat(a.size.value):150})}return b};g=function(a,d){var b,e,g,f;g=jQuery.Deferred();b=$("<canvas></canvas>");b.css("width","215px");b.css("height","215px");$(a).append(b);b=b.get()[0];b.width=860;b.height=860;e=b.getContext("2d");f=new c(d);h(f.utf8code,function(a){var b,c,d,h,
i,m;c=a.getElementsByTagName("Track");i=a.getElementsByTagName("Outline");m=[];a=d=0;for(h=i.length;d<h;a=++d)b=i[a],f.strokes.push({outline:k(b),track:l(c[a])}),m.push(g.resolve({drawBackground:function(){return f.drawBackground(e)},draw:function(){return f.draw(e)}}));return m});return g};window.WordStroker||(window.WordStroker={});return window.WordStroker.canvas={Word:c,createWordsAndViews:function(a,d){return Array.prototype.map.call(d,function(b){return g(a,b)})}}})}).call(this);(function(){var c,g;g=function(){var c;return null!=(c=document.createElement("canvas"))?c.getContext("2d"):void 0};c=jQuery;c.fn.extend({strokeWords:function(e,h){if(void 0===e||""===e)return null;h=c.extend({svg:!g()},h);return this.each(function(){var c,g,i;if(h.svg)return window.WordStroker.raphael.strokeWords(this,e);i=window.WordStroker.canvas.createWordsAndViews(this,e);i.forEach(function(a){return a.then(function(a){return a.drawBackground()})});c=0;g=function(){if(c<i.length)return i[c++].then(function(a){return a.draw().then(g)})};
return g()}).data("strokeWords",{play:null})}})}).call(this);
